"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=n(e),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=function(e){var n=e.getPageIndex,i=e.store,a=r.useState(),u=a[0],c=a[1],o=function(e){c(e)},s=window.devicePixelRatio||1,l=r.useRef(),g=r.useRef(),h=r.useState(!1),p=h[0],f=h[1];return r.useEffect((function(){if(u){var e=g.current,t=l.current;if(e&&t){var r=u.numPages,i=n?n({numPages:r}):0,a=Math.max(0,Math.min(i,r-1));u.getPage(a+1).then((function(n){var r=n.getViewport({scale:1}),i=r.width,a=r.height,u=e.clientWidth,c=e.clientHeight,o=Math.min(u/i,c/a),l=o*i,g=o*a;t.height=g*s,t.width=l*s,t.style.opacity="0";var h=t.getContext("2d",{alpha:!1}),p=n.getViewport({rotation:0,scale:o*s});n.render({canvasContext:h,viewport:p}).promise.then((function(){f(!0),t.style.removeProperty("opacity")}),(function(){f(!0)}))}))}}}),[u]),r.useEffect((function(){return i.subscribe("doc",o),function(){i.unsubscribe("doc",o)}}),[]),r.createElement("div",{className:"rpv-thumbnail__cover",ref:g},!p&&r.createElement("div",{className:"rpv-thumbnail__cover-loader"},r.createElement(t.Spinner,null)),r.createElement("canvas",{ref:l,style:{transform:"scale("+1/s+")",transformOrigin:"top left"}}))},u=function(e){var n=e.page,i=e.pageHeight,a=e.pageIndex,u=e.pageWidth,c=e.rotation,o=e.thumbnailHeight,s=e.thumbnailWidth,l=r.useContext(t.LocalizationContext).l10n,g=r.useRef(),h=r.useState(""),p=h[0],f=h[1],d=l&&l.thumbnail?l.thumbnail.thumbnailLabel:"Thumbnail of page {{pageIndex}}";return r.useEffect((function(){var e=g.current;e&&e.cancel();var t=document.createElement("canvas"),r=t.getContext("2d",{alpha:!1}),a=s,o=a/(u/i),l=a/u;t.height=o,t.width=a,t.style.height=o+"px",t.style.width=a+"px";var h=n.getViewport({rotation:c,scale:l});g.current=n.render({canvasContext:r,viewport:h}),g.current.promise.then((function(){return f(t.toDataURL())}),(function(){}))}),[c]),p?r.createElement("img",{"aria-label":d.replace("{{pageIndex}}",""+(a+1)),src:p,height:o+"px",width:s+"px"}):r.createElement(t.Spinner,null)},c=function(e){var n=e.doc,i=e.isActive,a=e.pageHeight,c=e.pageIndex,o=e.pageWidth,s=e.rotation,l=e.onActive,g=r.useState({height:a,isCalculated:!1,page:null,viewportRotation:0,width:o}),h=g[0],p=g[1],f=r.useRef({isVisible:!1,ratio:0}),d=h.isCalculated,m=h.page,b=h.height,v=h.width,x=v/b,E=Math.abs(s)%180==0,w=E?100:100/x,y=E?100/x:100;r.useLayoutEffect((function(){if(i){var e=P.current,t=f.current;(!t.isVisible||t.ratio<1)&&l(e)}}),[i]);var _=(s+h.viewportRotation)%360,P=t.useIntersectionObserver({onVisibilityChanged:function(e){f.current=e,e.isVisible&&!d&&n.getPage(c+1).then((function(e){var t=e.getViewport({scale:1});p({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return r.createElement("div",{className:"rpv-thumbnail__container",ref:P,style:{height:y+"px",width:w+"px"}},m?r.createElement(u,{page:m,pageHeight:E?b:v,pageIndex:c,pageWidth:E?v:b,rotation:_,thumbnailHeight:y,thumbnailWidth:w}):r.createElement(t.Spinner,null))},o=function(e){var n=e.currentPage,i=e.doc,a=e.pageHeight,u=e.pageWidth,o=e.rotation,s=e.onJumpToPage,l=i.numPages,g=r.useRef(null),h=r.useRef([]),p=r.useState(n),f=p[0],d=p[1],m=r.useContext(t.ThemeContext).direction===t.TextDirection.RightToLeft,b=function(e){var t=g.current;t&&function(e,t){var n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,r=e.clientHeight,i=t.clientHeight;n<0?t.scrollTop+=n:n+r<=i||(t.scrollTop+=n+r-i)}(e.parentElement,t)},v=function(){if(g.current){var e=h.current,t=f+1;t<e.length&&(f>=0&&e[f].setAttribute("tabindex","-1"),d(t))}},x=function(){if(g.current){var e=h.current,t=f-1;t>=0&&(f>=0&&e[f].setAttribute("tabindex","-1"),d(t))}},E=function(){f>=0&&f<l&&s(f)};return t.useIsomorphicLayoutEffect((function(){var e=g.current;e&&(h.current=Array.from(e.querySelectorAll(".rpv-thumbnail__item")))}),[]),r.useEffect((function(){var e=h.current;if(!(0===e.length||f<0||f>e.length)){var t=e[f];t.setAttribute("tabindex","0"),t.focus()}}),[f]),r.createElement("div",{ref:g,"data-testid":"thumbnail__list",className:t.classNames({"rpv-thumbnail__list":!0,"rpv-thumbnail__list--rtl":m}),onKeyDown:function(e){switch(e.key){case"ArrowDown":v();break;case"ArrowUp":x();break;case"Enter":E()}}},Array(l).fill(0).map((function(e,l){return r.createElement("div",{key:"thumbnail-"+l},r.createElement("div",{className:t.classNames({"rpv-thumbnail__item":!0,"rpv-thumbnail__item--selected":n===l}),role:"button",tabIndex:n===l?0:-1,onClick:function(){return s(l)}},r.createElement(c,{doc:i,isActive:n===l,pageHeight:a,pageIndex:l,pageWidth:u,rotation:o,onActive:b})),r.createElement("div",{className:"rpv-thumbnail__index"},l+1))})))},s=function(e){var n=e.store,i=r.useState(n.get("doc")),a=i[0],u=i[1],c=r.useState(n.get("currentPage")||0),s=c[0],l=c[1],g=r.useState(n.get("pageHeight")||0),h=g[0],p=g[1],f=r.useState(n.get("pageWidth")||0),d=f[0],m=f[1],b=r.useState(n.get("rotation")||0),v=b[0],x=b[1],E=function(e){l(e)},w=function(e){u(e)},y=function(e){p(e)},_=function(e){m(e)},P=function(e){x(e)};return r.useEffect((function(){return n.subscribe("doc",w),n.subscribe("pageHeight",y),n.subscribe("pageWidth",_),n.subscribe("rotation",P),function(){n.unsubscribe("doc",w),n.unsubscribe("pageHeight",y),n.unsubscribe("pageWidth",_),n.unsubscribe("rotation",P)}}),[]),t.useIsomorphicLayoutEffect((function(){return n.subscribe("currentPage",E),function(){n.unsubscribe("currentPage",E)}}),[]),a?r.createElement(o,{currentPage:s,doc:a,pageHeight:h,pageWidth:d,rotation:v,onJumpToPage:function(e){var t=n.get("jumpToPage");t&&t(e)}}):r.createElement("div",{className:"rpv-thumbnail__loader"},r.createElement(t.Spinner,null))};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */exports.thumbnailPlugin=function(){var e=r.useMemo((function(){return t.createStore({})}),[]);return{install:function(t){e.update("jumpToPage",t.jumpToPage)},onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("currentPage",t.pageIndex),e.update("pageHeight",t.pageHeight),e.update("pageWidth",t.pageWidth),t},Cover:function(t){return r.createElement(a,i({},t,{store:e}))},Thumbnails:function(){return r.createElement(s,{store:e})}}};
